"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ –±–æ—Ç–µ.
–°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –ø–æ–≥–æ–¥—ã –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è JSON.
"""

import logging
from typing import Any, Dict, Tuple

import httpx


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


def interpret_weather_code(code: int) -> str:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —á–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ –ø–æ–≥–æ–¥—ã –∏–∑ Open-Meteo –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–º–æ–¥–∑–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.

    :param code: —á–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ –ø–æ–≥–æ–¥—ã.
    :return: —Å—Ç—Ä–æ–∫–∞ —Å —ç–º–æ–¥–∑–∏ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ–≥–æ–¥—ã.
    """
    code = int(code)
    weather_mapping: Dict[int, str] = {
        0: "‚òÄÔ∏è –Ø—Å–Ω–æ",
        1: "üå§ –í –æ—Å–Ω–æ–≤–Ω–æ–º —è—Å–Ω–æ",
        2: "‚õÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å",
        3: "‚òÅÔ∏è –ü–∞—Å–º—É—Ä–Ω–æ",
        45: "üå´ –¢—É–º–∞–Ω",
        48: "üå´Ô∏è –¢—É–º–∞–Ω, –∏–Ω–µ–π",
        51: "üåß –õ—ë–≥–∫–∞—è –º–æ—Ä–æ—Å—å",
        53: "üåß –£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å",
        55: "üåß –°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å",
        61: "üå¶ –õ—ë–≥–∫–∏–π –¥–æ–∂–¥—å",
        63: "üåß –£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å",
        65: "üåß –°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å",
        71: "üå® –õ—ë–≥–∫–∏–π —Å–Ω–µ–≥",
        73: "üå® –£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥",
        75: "üå® –°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥",
        77: "üå® –°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞",
        80: "‚õà –õ—ë–≥–∫–∏–µ –ª–∏–≤–Ω–∏",
        81: "‚õà –£–º–µ—Ä–µ–Ω–Ω—ã–µ –ª–∏–≤–Ω–∏",
        82: "‚õà –°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–∏",
        85: "üå® –õ—ë–≥–∫–∏–π —Å–Ω–µ–∂–Ω—ã–π –ª–∏–≤–µ–Ω—å",
        86: "üå® –°–∏–ª—å–Ω—ã–π —Å–Ω–µ–∂–Ω—ã–π –ª–∏–≤–µ–Ω—å",
        95: "üå© –ì—Ä–æ–∑–∞",
        96: "‚õà –ì—Ä–æ–∑–∞ —Å –ª—ë–≥–∫–∏–º –≥—Ä–∞–¥–æ–º",
        99: "‚õà –ì—Ä–æ–∑–∞ —Å —Å–∏–ª—å–Ω—ã–º –≥—Ä–∞–¥–æ–º",
    }
    return weather_mapping.get(code, f"üåÄ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥: {code}")


async def fetch_json(
    client: httpx.AsyncClient, url: str, name: str
) -> Tuple[str, Dict[str, Any] | None]:
    """
    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç JSON –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É URL.

    :param client: —ç–∫–∑–µ–º–ø–ª—è—Ä httpx.AsyncClient –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
    :param url: URL –¥–ª—è GET-–∑–∞–ø—Ä–æ—Å–∞.
    :param name: –º–µ—Ç–∫–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞.
    :return: –∫–æ—Ä—Ç–µ–∂ (name, json_data), –≥–¥–µ json_data ‚Äî —Å–ª–æ–≤–∞—Ä—å –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ.
    """
    try:
        response = await client.get(url)
        response.raise_for_status()
        return name, response.json()
    except Exception as e:
        logger.error(f"Error fetching {url}: {e}")
        return name, None